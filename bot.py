from telegram import Update
from telegram.ext import Application, CommandHandler, ContextTypes
import random

# Store users waiting for a match
waiting_users = []

# Command handler for /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ ØªØ­Ø¯ÙŠÙ‚Ø© Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©)

# Command handler for /privacy
async def privacy_policy(update: Update, context: ContextTypes.DEFAULT_TYPE):
    privacy_message = (
        "ğŸ”’ **Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©**\n\n"
        "Ø®ØµÙˆØµÙŠØªÙƒ Ù…Ù‡Ù…Ø© Ù„Ù†Ø§. Ø¥Ù„ÙŠÙƒ ÙƒÙŠÙÙŠØ© ØªØ¹Ø§Ù…Ù„Ù†Ø§ Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ:\n\n"
        "1. Ù†Ø­Ù† Ù„Ø§ Ù†Ø®Ø²Ù† Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø®ØµÙŠØ©.\n"
        "2. Ù†Ø­Ù† Ù„Ø§ Ù†Ø´Ø§Ø±Ùƒ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø¹ Ø£Ø·Ø±Ø§Ù Ø«Ø§Ù„Ø«Ø©.\n"
        "3. Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª Ù…Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ø¨ÙˆØª Ø¢Ù…Ù†Ø©.\n\n"
        "Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø£Ø³Ø¦Ù„Ø©ØŒ ÙÙ„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø§."
    )
    await update.message.reply_text(privacy_message)

# Command handler for /help
async def help_ar(update: Update, context: ContextTypes.DEFAULT_TYPE):
    help_message = (
        "ğŸ›  **Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø±**\n\n"
        "Ø§Ø¨Ø¯Ø£ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØª Ù…Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ø£ÙˆØ§Ù…Ø±:\n\n"
        "/start - Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„\n"
        "/privacy - Ø¹Ø±Ø¶ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©\n"
        "/help - Ø¹Ø±Ø¶ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©\n"
        "/videochat - Ø¨Ø¯Ø¡ Ø¯Ø±Ø¯Ø´Ø© ÙÙŠØ¯ÙŠÙˆ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©"
    )
    await update.message.reply_text(help_message)

# Command handler for /videochat
async def start_video_chat(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.message.from_user.id
    user_name = update.message.from_user.first_name

    # Add the user to the waiting list
    waiting_users.append((user_id, user_name))

    if len(waiting_users) >= 2:
        # Pair two random users
        user1, user2 = random.sample(waiting_users, 2)
        waiting_users.remove(user1)
        waiting_users.remove(user2)

        # Generate a unique video chat link using Jitsi Meet
        room_name = f"random-chat-{user1[0]}-{user2[0]}"
        video_chat_link = f"https://meet.jit.si/{room_name}?jitsi_meet_external_api_id=0&config.startWithVideoMuted=true&config.startWithAudioMuted=true"

        # Send the link to both users with an Arabic permission message
        await context.bot.send_message(
            chat_id=user1[0],
            text=f"ğŸ¥ Ù„Ù‚Ø¯ ØªÙ… Ø¥Ù‚Ø±Ø§Ù†Ùƒ Ù…Ø¹ {user2[1]}! Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø¨Ø¯Ø¡ Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: {video_chat_link}\n\n"
                 "ğŸ’¡ **Ù…Ù„Ø§Ø­Ø¸Ø©**: Ø¥Ø°Ø§ Ù„Ù… ØªØ¹Ù…Ù„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø£Ùˆ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù†Ø­ Ø§Ù„Ø¥Ø°Ù† ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­."
        )
        await context.bot.send_message(
            chat_id=user2[0],
            text=f"ğŸ¥ Ù„Ù‚Ø¯ ØªÙ… Ø¥Ù‚Ø±Ø§Ù†Ùƒ Ù…Ø¹ {user1[1]}! Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø¨Ø¯Ø¡ Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: {video_chat_link}\n\n"
                 "ğŸ’¡ **Ù…Ù„Ø§Ø­Ø¸Ø©**: Ø¥Ø°Ø§ Ù„Ù… ØªØ¹Ù…Ù„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø£Ùˆ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù†Ø­ Ø§Ù„Ø¥Ø°Ù† ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­."
        )
    else:
        await update.message.reply_text("â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø³ØªØ®Ø¯Ù… Ø¢Ø®Ø± Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù…...")

def main():
    # Replace with your bot's API token
    TOKEN = "7332555745:AAEGdPx1guRECMlIjlxTvms8Xx5EFDELelU"

    # Create the Application
    application = Application.builder().token(TOKEN).build()

    # Add command handlers
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("privacy", privacy_policy))
    application.add_handler(CommandHandler("help", help_ar))
    application.add_handler(CommandHandler("videochat", start_video_chat))

    # Start the bot
    print("Bot is running...")
    application.run_polling()

if __name__ == "__main__":
    main()
